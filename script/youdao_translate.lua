--[[
--æ— éšœç¢ç‰ˆä¸“ç”¨è„šæœ¬
--æœ‰é“ç¿»è¯‘
--ç‰ˆæœ¬å·: 1.1
--æ–°å¢ç¿»è¯‘ã€å‰ªåˆ‡æ¿ã€‘å†…å®¹
--è¯´æ˜: 
--1.ã€ç¼–è¾‘æ¡†é€‰ä¸­æ–‡å­—ã€‘æ¨¡å¼ç»æµ‹è¯•å°ç±³max2_miui10.3ä¸Šå¯ç”¨,å…¶å®ƒç³»ç»Ÿå¯èƒ½å­˜åœ¨å…¼å®¹é—®é¢˜.è‹¥å­˜åœ¨æ­¤é—®é¢˜,æ¨èå¤åˆ¶åˆ°ã€å‰ªåˆ‡æ¿ã€‘,å†å¯ç”¨ç›¸å…³è„šæœ¬åŠŸèƒ½
--2.ç»æµ‹è¯•,ä¸­æ–‡Â»è‹±è¯­,ä¸­æ–‡Â»éŸ©è¯­,è‹±è¯­Â»ä¸­æ–‡å¯å¸¸ç”¨,å…¶å®ƒçŸ­æ—¶é—´ä½¿ç”¨é¢‘ç¹çš„è¯æ˜“è¢«æœ‰é“æ£€æµ‹ä¸ºipå¼‚å¸¸,è„šæœ¬ä¼šæŠ¥é”™,å¯åˆ‡æ¢ç½‘ç»œé€šé“é¿å¼€
--åˆ¶ä½œæ—¥æœŸ
â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚
æ—¥æœŸ: 2020å¹´03æœˆ08æ—¥ğŸ—“ï¸
å†œå†: é¼ (åºšå­)å¹´äºŒæœˆåäº”
æ—¶é—´: 21:30:55ğŸ•˜
æ˜ŸæœŸ: å‘¨æ—¥


--ç‰ˆæœ¬å·: 1.0
--åˆ¶ä½œæ—¥æœŸ
â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚
æ—¥æœŸ: 2020å¹´03æœˆ07æ—¥ğŸ—“ï¸
å†œå†: é¼ (åºšå­)å¹´äºŒæœˆåå››
æ—¶é—´: 21:27:01ğŸ•˜
æ˜ŸæœŸ: å‘¨å…­
--ç”¨é€”ï¼šå¤šå›½è¯­è¨€äº’è¯‘,å¯ç¿»è¯‘ã€å½“å‰å€™é€‰ã€‘,ã€ç¼–è¾‘æ¡†é€‰ä¸­æ–‡å­—ã€‘åŠã€ç¼–ç ã€‘,ç¿»è¯‘å†…å®¹åœ¨æ‚¬æµ®çª—å£æ˜¾ç¤º
--è¯´æ˜: ã€ç¼–ç ã€‘ç¿»è¯‘æ¨¡å¼åªæ”¯æŒå°†ç¼–ç è½¬æˆè‹±æ–‡,ç„¶åç¿»è¯‘ä¸ºä¸­æ–‡,é»˜è®¤å°†åˆ†éš”ç¬¦è½¬æ¢ä¸ºç©ºæ ¼.ç›®å‰åˆ†éš”ç¬¦åªæ”¯æŒ',å…¶å®ƒå¾…ä¼˜åŒ–
--åˆ¶ä½œè€…: é£ä¹‹æ¼«èˆ
--é¦–å‘qqç¾¤: åŒæ–‡å ‚(480159874)
--é‚®ç®±: bj19490007@163.com(ä¸ä¸€å®šåŠæ—¶çœ‹åˆ°)
--ç›®å‰æ”¯æŒä»¥ä¸‹è¯­ç§é—´çš„è½¬æ¢
typeçš„ç±»å‹æœ‰ï¼š
AUTO è‡ªåŠ¨è¯†åˆ«å†…å®¹å¹¶ç¿»è¯‘
ZH_CN2EN ä¸­æ–‡ã€€Â»ã€€è‹±è¯­
ZH_CN2JA ä¸­æ–‡ã€€Â»ã€€æ—¥è¯­
ZH_CN2KR ä¸­æ–‡ã€€Â»ã€€éŸ©è¯­
ZH_CN2FR ä¸­æ–‡ã€€Â»ã€€æ³•è¯­
ZH_CN2RU ä¸­æ–‡ã€€Â»ã€€ä¿„è¯­
ZH_CN2SP ä¸­æ–‡ã€€Â»ã€€è¥¿è¯­
EN2ZH_CN è‹±è¯­ã€€Â»ã€€ä¸­æ–‡
JA2ZH_CN æ—¥è¯­ã€€Â»ã€€ä¸­æ–‡
KR2ZH_CN éŸ©è¯­ã€€Â»ã€€ä¸­æ–‡
FR2ZH_CN æ³•è¯­ã€€Â»ã€€ä¸­æ–‡
RU2ZH_CN ä¿„è¯­ã€€Â»ã€€ä¸­æ–‡
SP2ZH_CN è¥¿è¯­ã€€Â»ã€€ä¸­æ–‡


--å¦‚ä½•å®‰è£…å¹¶ä½¿ç”¨: è¯·å‚è€ƒç¾¤æ–‡ä»¶ï¼Œè·¯å¾„[åŒæ–‡æ— éšœç¢LUAè„šæœ¬]->åŒæ–‡æ— éšœç¢ç‰ˆluaè„šæœ¬ä½¿ç”¨è¯´æ˜.pdf

--é…ç½®è¯´æ˜
ç¬¬â‘ æ­¥ å°† æœ‰é“ç¿»è¯‘.lua æ–‡ä»¶æ”¾ç½® rime/script æ–‡ä»¶å¤¹å†…

ç¬¬â‘¡æ­¥ å‘ä¸»é¢˜æ–¹æ¡ˆä¸­åŠ å…¥æŒ‰é”®
ä»¥ XXX.trime.yamlä¸»é¢˜æ–¹æ¡ˆä¸ºä¾‹
æ‰¾åˆ°ä»¥ä¸‹èŠ‚ç‚¹preset_keysï¼ŒåŠ å…¥ä»¥ä¸‹æŒ‰é”®

preset_keys:
  #æœ‰é“ç¿»è¯‘,å°†ã€å½“å‰å€™é€‰ã€‘,ã€ç¼–è¾‘æ¡†é€‰ä¸­æ–‡å­—ã€‘çš„ä¸­æ–‡å†…å®¹è½¬å…¶å®ƒè¯­ç§
  youdao_1: {label: ç¿»è¯‘, send: function, command: 'æœ‰é“ç¿»è¯‘.lua', option: "%1$s<ZH_CN2EN>"} #ä¸­æ–‡Â»è‹±è¯­
  youdao_2: {label: ç¿»è¯‘, send: function, command: 'æœ‰é“ç¿»è¯‘.lua', option: "%1$s<ZH_CN2JA>"} #ä¸­æ–‡Â»æ—¥è¯­
  youdao_3: {label: ç¿»è¯‘, send: function, command: 'æœ‰é“ç¿»è¯‘.lua', option: "%1$s<ZH_CN2KR>"} #ä¸­æ–‡Â»éŸ©è¯­
  youdao_4: {label: ç¿»è¯‘, send: function, command: 'æœ‰é“ç¿»è¯‘.lua', option: "%1$s<ZH_CN2FR>"} #ä¸­æ–‡Â»æ³•è¯­
  youdao_5: {label: ç¿»è¯‘, send: function, command: 'æœ‰é“ç¿»è¯‘.lua', option: "%1$s<ZH_CN2RU>"} #ä¸­æ–‡Â»ä¿„è¯­
  youdao_6: {label: ç¿»è¯‘, send: function, command: 'æœ‰é“ç¿»è¯‘.lua', option: "%1$s<ZH_CN2SP>"} #ä¸­æ–‡Â»è¥¿è¯­

 #æœ‰é“ç¿»è¯‘,å°†ã€å½“å‰å€™é€‰ã€‘,ã€ç¼–è¾‘æ¡†é€‰ä¸­æ–‡å­—ã€‘å†…å®¹ç¿»è¯‘ä¸ºä¸­æ–‡,å¦‚è‹±è¯­å•è¯åŠå¥å­
  youdao_7: {label: ç¿»è¯‘, send: function, command: 'æœ‰é“ç¿»è¯‘.lua', option: "%1$s<EN2ZH_CN>"} #è‹±è¯­Â»ä¸­æ–‡
  youdao_8: {label: ç¿»è¯‘, send: function, command: 'æœ‰é“ç¿»è¯‘.lua', option: "%1$s<JA2ZH_CN>"} #æ—¥è¯­Â»ä¸­æ–‡
  youdao_9: {label: ç¿»è¯‘, send: function, command: 'æœ‰é“ç¿»è¯‘.lua', option: "%1$s<KR2ZH_CN>"} #éŸ©è¯­Â»ä¸­æ–‡
  youdao_10: {label: ç¿»è¯‘, send: function, command: 'æœ‰é“ç¿»è¯‘.lua', option: "%1$s<FR2ZH_CN>"} #æ³•è¯­Â»ä¸­æ–‡
  youdao_11: {label: ç¿»è¯‘, send: function, command: 'æœ‰é“ç¿»è¯‘.lua', option: "%1$s<RU2ZH_CN>"} #ä¿„è¯­Â»ä¸­æ–‡
  youdao_12: {label: ç¿»è¯‘, send: function, command: 'æœ‰é“ç¿»è¯‘.lua', option: "%1$s<SP2ZH_CN>"} #è¥¿è¯­Â»ä¸­æ–‡

 #æœ‰é“ç¿»è¯‘,å°†ã€ç¼–ç ã€‘è½¬æ¢ä¸ºè‹±è¯­å•è¯åŠå¥å­,å…¶ä¸­åˆ†éš”ç¬¦å¦‚'è½¬æ¢ä¸ºç©ºæ ¼,ç¿»è¯‘æˆä¸­æ–‡,
  youdao_13: {label: ç¿»è¯‘, send: function, command: 'æœ‰é“ç¿»è¯‘.lua', option: "%2$s<EN2ZH_CN>"} #ç¼–ç Â»è‹±è¯­Â»ä¸­æ–‡

  #æœ‰é“ç¿»è¯‘,å°†ã€å‰ªåˆ‡æ¿ã€‘çš„ä¸­æ–‡å†…å®¹ç¿»è¯‘æˆå…¶å®ƒè¯­ç§
  youdao_cv1: {label: ç¿»è¯‘, send: function, command: 'æœ‰é“ç¿»è¯‘.lua', option: "<ZH_CN2EN>"} #ä¸­æ–‡Â»è‹±è¯­
  youdao_cv2: {label: ç¿»è¯‘, send: function, command: 'æœ‰é“ç¿»è¯‘.lua', option: "<ZH_CN2JA>"} #ä¸­æ–‡Â»æ—¥è¯­
  youdao_cv3: {label: ç¿»è¯‘, send: function, command: 'æœ‰é“ç¿»è¯‘.lua', option: "<ZH_CN2KR>"} #ä¸­æ–‡Â»éŸ©è¯­
  youdao_cv4: {label: ç¿»è¯‘, send: function, command: 'æœ‰é“ç¿»è¯‘.lua', option: "<ZH_CN2FR>"} #ä¸­æ–‡Â»æ³•è¯­
  youdao_cv5: {label: ç¿»è¯‘, send: function, command: 'æœ‰é“ç¿»è¯‘.lua', option: "<ZH_CN2RU>"} #ä¸­æ–‡Â»ä¿„è¯­
  youdao_cv6: {label: ç¿»è¯‘, send: function, command: 'æœ‰é“ç¿»è¯‘.lua', option: "<ZH_CN2SP>"} #ä¸­æ–‡Â»è¥¿è¯­

 #æœ‰é“ç¿»è¯‘,å°†ã€å‰ªåˆ‡æ¿ã€‘å†…å®¹ç¿»è¯‘ä¸ºä¸­æ–‡,å¦‚è‹±è¯­å•è¯åŠå¥å­
  youdao_cv7: {label: ç¿»è¯‘, send: function, command: 'æœ‰é“ç¿»è¯‘.lua', option: "<EN2ZH_CN>"} #è‹±è¯­Â»ä¸­æ–‡
  youdao_cv8: {label: ç¿»è¯‘, send: function, command: 'æœ‰é“ç¿»è¯‘.lua', option: "<JA2ZH_CN>"} #æ—¥è¯­Â»ä¸­æ–‡
  youdao_cv9: {label: ç¿»è¯‘, send: function, command: 'æœ‰é“ç¿»è¯‘.lua', option: "<KR2ZH_CN>"} #éŸ©è¯­Â»ä¸­æ–‡
  youdao_cv10: {label: ç¿»è¯‘, send: function, command: 'æœ‰é“ç¿»è¯‘.lua', option: "<FR2ZH_CN>"} #æ³•è¯­Â»ä¸­æ–‡
  youdao_cv11: {label: ç¿»è¯‘, send: function, command: 'æœ‰é“ç¿»è¯‘.lua', option: "<RU2ZH_CN>"} #ä¿„è¯­Â»ä¸­æ–‡
  youdao_cv12: {label: ç¿»è¯‘, send: function, command: 'æœ‰é“ç¿»è¯‘.lua', option: "<SP2ZH_CN>"} #è¥¿è¯­Â»ä¸­æ–‡

å‘è¯¥æ–¹æ¡ˆä»»æ„æŒ‰é”®åŠ å…¥ä¸Šè¿°æŒ‰é”®æ—¢å¯
]]

require "import"
import "android.app.*"
import "android.os.*"
import "android.widget.*"
import "android.view.*"
import "android.content.Context" 


local å€™é€‰ = (...)
local å®é™…å†…å®¹=å€™é€‰
local ç¿»è¯‘ç±»å‹="AUTO"


if string.sub(å€™é€‰,1,1)!="<" && string.sub(å€™é€‰,#å€™é€‰-9,#å€™é€‰-9)=="<" && string.sub(å€™é€‰,#å€™é€‰,#å€™é€‰)==">" then
 å®é™…å†…å®¹=string.sub(å€™é€‰,1,#å€™é€‰-10)
 å®é™…å†…å®¹=string.gsub(å®é™…å†…å®¹,"'"," ")
 å®é™…å†…å®¹=string.gsub(å®é™…å†…å®¹,"%.","")
 ç¿»è¯‘ç±»å‹=string.sub(å€™é€‰,#å€™é€‰-8,#å€™é€‰-1)
end

if string.sub(å€™é€‰,1,1)=="<" then
 å®é™…å†…å®¹=tostring(service.getSystemService(Context.CLIPBOARD_SERVICE).getText()) --è·å–å‰ªè´´æ¿ 
 ç¿»è¯‘ç±»å‹=string.sub(å€™é€‰,#å€™é€‰-8,#å€™é€‰-1)
end


--http://fanyi.youdao.com/translate?&doctype=json&type="<ZH_CN2EN>"&i=ä½ å¥½"
--http://fanyi.youdao.com/translate?&doctype=json&type="<EN2ZH_CN>"&i=gym"


--Toast.makeText(service, ç¿»è¯‘ç±»å‹,Toast.LENGTH_SHORT).show() --å¼¹å‡ºä¿¡æ¯

local äº‘è¾“å…¥å†…å®¹="http://fanyi.youdao.com/translate?&doctype=json&type="..ç¿»è¯‘ç±»å‹.."&i="..å®é™…å†…å®¹

Http.get(äº‘è¾“å…¥å†…å®¹,nil,"utf8",nil,function(a,b)
 if a==200 then 
  if string.find(b,"ipçš„è¯·æ±‚å¼‚å¸¸é¢‘ç¹")!=nil then
   print("æœ‰é“æ£€æµ‹ipè¯·æ±‚é¢‘ç¹,å»ºè®®åˆ‡æ¢ç½‘ç»œ")
   return
  end
 json=import"cjson"
 --print(tostring(b))
 local jx=json.decode(b)
 local ç¿»è¯‘å†…å®¹=jx.translateResult[1][1].tgt
 --{"type":"ZH_CN2JA","errorCode":0,"elapsedTime":1,"translateResult":[[{"src":"æœ‰é“ç¿»è¯‘","tgt":"åŠªã‚ã‚Œç¿»è¨³"}]]}
 local å†…å®¹1=ç¿»è¯‘å†…å®¹..".("..å®é™…å†…å®¹..")"
 task(100,function()
  service.addCompositions({å®é™…å†…å®¹,å†…å®¹1}) end)
 else
 print("ç½‘ç»œä¼¼ä¹å‡ºäº†é—®é¢˜")
 end
 end)

